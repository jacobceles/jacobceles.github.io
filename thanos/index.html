<!DOCTYPE html>
<html lang="en">
   <head>
      <title>Thanos JSON Generator</title>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous" />
      <link rel="stylesheet" style="text/css" href="css/custom.css" />
   </head>
   <body>
      <section id="cover" class="min-vh-100">
         <div id="cover-caption">
            <div class="container">
               <div class="row text-white">
                  <div class="col-xl-12 col-lg-6 col-md-8 col-sm-10 mx-auto form p-4">
                     <h1 class="display-4 py-2 text-truncate text-center">THANOS</h1>
                     <div class="px-2">

                      <!-- Nav tabs -->
                      <ul class="nav nav-tabs nav-justified" role="tablist">
                        <li class="nav-item">
                          <a class="nav-link active" data-toggle="tab" href="#sources">Sources</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-toggle="tab" href="#transformations">Transformations</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-toggle="tab" href="#targets">Targets</a>
                        </li>
                      </ul>

                      <!-- Tab panes -->
                      <div class="tab-content">
                        <form class="container tab-pane active" id="sources" >
                        </form>
                        <form class="container tab-pane fade" id="transformations">
                        </form>
                        <form class="container tab-pane fade" id="targets">
                        </form>
                      </div>

                     </div>
                  </div>
               </div>
            </div>
         </div>
      </section>
      <script type="text/javascript" src="js/jquery.min.js"></script>
      <script type="text/javascript" src="js/underscore.js"></script>
      <script type="text/javascript" src="js/jsonform.js"></script>
      <script type="text/javascript">

        $.getJSON('https://jacobcelestine.com/thanos/json/sources_components.json', function (sourceComponents) {
            getSourceForm(sourceComponents)
          });

        function getSourceForm(sourceComponents) {
          $.getJSON('https://jacobcelestine.com/thanos/json/sources_form.json', function (sourceForm) {
            generateForm(sourceComponents, sourceForm, "sources")
          });
        }

        $.getJSON('https://jacobcelestine.com/thanos/json/targets_components.json', function (targetComponents) {
            getTargetForm(targetComponents)
          });

        function getTargetForm(targetComponents) {
          $.getJSON('https://jacobcelestine.com/thanos/json/targets_form.json', function (targetForm) {
            generateForm(targetComponents, targetForm, "targets")
          });
        }

        $.getJSON('https://jacobcelestine.com/thanos/json/transformations_components.json', function (transformationComponents) {
            getTransformationForm(transformationComponents)
          });

        function getTransformationForm(transformationComponents) {
          $.getJSON('https://jacobcelestine.com/thanos/json/transformations_form.json', function (transformationForm) {
            generateForm(transformationComponents, transformationForm, "transformations")
          });
        }

        function generateForm(components, form, tabId) {
          var onSubmit = {
            onSubmit: function (errors, values) {
              var dataStr = "data:text/json;charset=utf-8," +
                encodeURIComponent(JSON.stringify(values, null, 1));
              console.log(dataStr)
              var downloadAnchorNode = document.createElement('a');

              downloadAnchorNode.setAttribute("href", dataStr);
              downloadAnchorNode.setAttribute("download", "thanos_" + tabId + ".json");
              document.body.appendChild(downloadAnchorNode); // required for firefox
              downloadAnchorNode.click();
              downloadAnchorNode.remove();
            }
          }

          var data = {
            ...components,
            ...form,
            ...onSubmit
          }
          console.log(data)
          $("#" + tabId).jsonForm(
            data
          );
        }
      </script>
   </body>
</html>